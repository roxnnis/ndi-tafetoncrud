<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NDI - Module d'Enregistrement Audio</title>
    <link rel="stylesheet" href="../../assets/CSS/audio_recorder.css">
</head>
<body>
    <div class="audio-recorder-container">
        <!-- En-t√™te -->
        <header class="header">
            <h1>üéôÔ∏è Module d'Enregistrement Audio</h1>
            <p class="subtitle">Enregistrement, transcription et d√©tection intelligente</p>
        </header>

        <!-- Panneau de contr√¥le principal -->
        <div class="main-panel">
            <div class="control-section">
                <h2>Panneau de Contr√¥le</h2>
                
                <!-- Boutons de contr√¥le -->
                <div class="control-buttons">
                    <button id="startBtn" class="btn btn-start" title="D√©marrer l'enregistrement">
                        <span class="icon">‚è∫</span>
                        <span>D√©marrer</span>
                    </button>
                    <button id="pauseBtn" class="btn btn-pause" disabled title="Mettre en pause">
                        <span class="icon">‚è∏</span>
                        <span>Pause</span>
                    </button>
                    <button id="stopBtn" class="btn btn-stop" disabled title="Arr√™ter l'enregistrement">
                        <span class="icon">‚èπ</span>
                        <span>Arr√™ter</span>
                    </button>
                </div>

                <!-- Indicateur d'√©tat -->
                <div class="status-indicator">
                    <div class="status-light" id="statusLight"></div>
                    <span id="statusText">Pr√™t √† enregistrer</span>
                </div>

                <!-- Timer -->
                <div class="timer-display">
                    <span id="timerDisplay">00:00:00</span>
                </div>

                <!-- Options d'enregistrement -->
                <div class="recording-options">
                    <label class="checkbox-label">
                        <input type="checkbox" id="enableSilenceDetection" checked>
                        <span>D√©tection de blancs</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="enableTranscription">
                        <span>Transcription en temps r√©el</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="enableEmailAlerts" checked>
                        <span>Alertes email</span>
                    </label>
                </div>

                <!-- Visualiseur audio -->
                <div class="audio-visualizer">
                    <canvas id="audioCanvas"></canvas>
                </div>
            </div>

            <!-- Zone de transcription -->
            <div class="transcription-section" id="transcriptionSection" style="display: none;">
                <h3>üìù Transcription en temps r√©el</h3>
                <div class="transcription-display" id="transcriptionDisplay">
                    <p class="placeholder">La transcription appara√Ætra ici...</p>
                </div>
                <div class="transcription-stats">
                    <span>Mots: <strong id="wordCount">0</strong></span>
                    <span>Segments: <strong id="segmentCount">0</strong></span>
                </div>
            </div>
        </div>

        <!-- Onglets -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="recordings">üìÅ Enregistrements</button>
            <button class="tab-btn" data-tab="silences">üîá D√©tection de Blancs</button>
            <button class="tab-btn" data-tab="transcriptions">üìù Transcriptions</button>
            <button class="tab-btn" data-tab="config">‚öôÔ∏è Configuration</button>
            <button class="tab-btn" data-tab="statistics">üìä Statistiques</button>
        </div>

        <!-- Contenu des onglets -->
        <div class="tab-content">
            <!-- Onglet Enregistrements -->
            <div id="recordings" class="tab-panel active">
                <div class="panel-header">
                    <h2>Enregistrements</h2>
                    <button class="btn btn-secondary" id="cleanupBtn">üóëÔ∏è Nettoyer expir√©s</button>
                </div>
                <div class="recordings-list" id="recordingsList">
                    <p class="empty-message">Aucun enregistrement pour le moment</p>
                </div>
            </div>

            <!-- Onglet D√©tection de Blancs -->
            <div id="silences" class="tab-panel">
                <div class="panel-header">
                    <h2>D√©tection de Blancs</h2>
                    <div class="silence-stats">
                        <div class="stat-box">
                            <span class="stat-value" id="totalSilences">0</span>
                            <span class="stat-label">Total</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-value natural" id="naturalSilences">0</span>
                            <span class="stat-label">Naturels</span>
                        </div>
                        <div class="stat-box">
                            <span class="stat-value unnatural" id="unnaturalSilences">0</span>
                            <span class="stat-label">Non-naturels</span>
                        </div>
                    </div>
                </div>
                <div class="silences-list" id="silencesList">
                    <p class="empty-message">Aucun blanc d√©tect√©</p>
                </div>
            </div>

            <!-- Onglet Transcriptions -->
            <div id="transcriptions" class="tab-panel">
                <div class="panel-header">
                    <h2>Transcriptions</h2>
                </div>
                <div class="transcriptions-list" id="transcriptionsList">
                    <p class="empty-message">Aucune transcription disponible</p>
                </div>
            </div>

            <!-- Onglet Configuration -->
            <div id="config" class="tab-panel">
                <div class="config-sections">
                    <!-- Configuration Enregistrement -->
                    <div class="config-section">
                        <h3>üéôÔ∏è Enregistrement Audio</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label>Format audio</label>
                                <select id="audioFormat">
                                    <option value="audio/webm;codecs=opus">WebM (Opus)</option>
                                    <option value="audio/webm">WebM</option>
                                    <option value="audio/mp4">MP4</option>
                                    <option value="audio/ogg">OGG</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Qualit√© (bitrate)</label>
                                <select id="audioBitrate">
                                    <option value="64000">64 kbps</option>
                                    <option value="128000" selected>128 kbps</option>
                                    <option value="192000">192 kbps</option>
                                    <option value="256000">256 kbps</option>
                                    <option value="320000">320 kbps</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Dur√©e maximale</label>
                                <select id="maxDuration">
                                    <option value="1800000">30 minutes</option>
                                    <option value="3600000" selected>1 heure</option>
                                    <option value="7200000">2 heures</option>
                                    <option value="14400000">4 heures</option>
                                    <option value="28800000">8 heures</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Dur√©e de vie des fichiers (jours)</label>
                                <input type="number" id="retentionDays" min="1" max="365" value="30">
                            </div>
                        </div>
                    </div>

                    <!-- Configuration D√©tection de Blancs -->
                    <div class="config-section">
                        <h3>üîá D√©tection de Blancs</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <label>Seuil de d√©tection (dB)</label>
                                <input type="number" id="silenceThreshold" min="-100" max="0" value="-40">
                            </div>
                            <div class="form-group">
                                <label>Dur√©e minimale du blanc (ms)</label>
                                <input type="number" id="minSilenceDuration" min="100" max="10000" step="100" value="3000">
                            </div>
                            <div class="form-group">
                                <label>Dur√©e max blanc naturel (ms)</label>
                                <input type="number" id="naturalSilenceMax" min="1000" max="30000" step="1000" value="5000">
                            </div>
                            <div class="form-group">
                                <label>Seuil alerte notification (ms)</label>
                                <input type="number" id="notificationThreshold" min="5000" max="60000" step="1000" value="10000">
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="enableAIDetection" checked>
                                    <span>Activer la d√©tection IA</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Configuration Transcription -->
                    <div class="config-section">
                        <h3>üìù Transcription</h3>
                        <div class="config-form">
                            <div class="form-group">
                                <div style="background: #fff3cd; padding: 15px; border-radius: 5px; border-left: 4px solid #ffc107; margin-bottom: 15px;">
                                    <strong>‚ö†Ô∏è Compatibilit√© :</strong><br>
                                    La transcription utilise Web Speech API (gratuite) et fonctionne sur :<br>
                                    ‚úÖ Google Chrome<br>
                                    ‚úÖ Microsoft Edge<br>
                                    ‚úÖ Safari<br>
                                    ‚ùå Mozilla Firefox (non support√©)
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Langue</label>
                                <select id="transcriptionLanguage">
                                    <option value="fr-FR" selected>Fran√ßais</option>
                                    <option value="en-US">Anglais (US)</option>
                                    <option value="en-GB">Anglais (UK)</option>
                                    <option value="es-ES">Espagnol</option>
                                    <option value="de-DE">Allemand</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Seuil conversation longue (minutes)</label>
                                <input type="number" id="conversationThreshold" min="1" max="60" value="5">
                            </div>
                            <div class="form-group">
                                <label>Dur√©e max segment (minutes)</label>
                                <input type="number" id="segmentMaxDuration" min="1" max="120" value="10">
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="enableAutoSegmentation" checked>
                                    <span>Segmentation automatique</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="config-actions">
                    <button class="btn btn-primary" id="saveConfigBtn">üíæ Sauvegarder la configuration</button>
                    <button class="btn btn-secondary" id="resetConfigBtn">‚Ü∫ R√©initialiser</button>
                </div>
            </div>

            <!-- Onglet Statistiques -->
            <div id="statistics" class="tab-panel">
                <div class="panel-header">
                    <h2>Statistiques Globales</h2>
                    <button class="btn btn-secondary" id="generateReportBtn">üìÑ G√©n√©rer un rapport</button>
                </div>
                <div class="statistics-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìÅ</div>
                        <div class="stat-content">
                            <h3 id="statTotalRecordings">0</h3>
                            <p>Enregistrements</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-content">
                            <h3 id="statTotalDuration">0h 0m</h3>
                            <p>Dur√©e totale</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üíæ</div>
                        <div class="stat-content">
                            <h3 id="statTotalSize">0 MB</h3>
                            <p>Taille totale</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üîá</div>
                        <div class="stat-content">
                            <h3 id="statTotalSilences">0</h3>
                            <p>Blancs d√©tect√©s</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚ö†Ô∏è</div>
                        <div class="stat-content">
                            <h3 id="statAlertsSent">0</h3>
                            <p>Alertes envoy√©es</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìù</div>
                        <div class="stat-content">
                            <h3 id="statTranscriptions">0</h3>
                            <p>Transcriptions</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pour renommer -->
    <div id="renameModal" class="modal">
        <div class="modal-content">
            <h3>Renommer l'enregistrement</h3>
            <input type="text" id="renameInput" class="modal-input" placeholder="Nouveau nom">
            <div class="modal-actions">
                <button class="btn btn-primary" id="confirmRenameBtn">Confirmer</button>
                <button class="btn btn-secondary" id="cancelRenameBtn">Annuler</button>
            </div>
        </div>
    </div>

    <!-- Toast notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="../../MVC/Model/AudioRecorder.js"></script>
    <script src="../../MVC/Model/SilenceDetector.js"></script>
    <script src="../../MVC/Model/TranscriptionService.js"></script>
    <script src="../../MVC/Controller/audio_controller.js"></script>
    <script src="audio_recorder_ui.js"></script>
</body>
</html>
